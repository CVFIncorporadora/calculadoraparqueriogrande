<script>
const API_BASE = " https://backend-parque-riogrande.onrender.com";

let lotes = [];

// ðŸ”¹ CARREGA DO BACKEND (Render)
fetch(`${API_BASE}/lotes`)
  .then(res => res.json())
  .then(data => {
    lotes = data;
    montarTabela();
  })
  .catch(err => {
    alert("Erro ao carregar lotes");
    console.error(err);
  });

function montarTabela() {
  const tbody = document.querySelector("#tabela tbody");
  tbody.innerHTML = "";

  lotes.forEach((lote, index) => {
    const tr = document.createElement("tr");
    tr.className = lote.Vendido === true || lote.Vendido === "TRUE"
      ? "vendido"
      : "livre";

    tr.innerHTML = `
      <td>${lote.ID}</td>
      <td>${lote.Nome}</td>
      <td>${lote.Area}</td>

      <td>
        <input 
          type="number"
          value="${lote.Valor}"
          style="width:120px"
          onchange="alterarValor(${index}, this.value)"
        >
      </td>

      <td>
        <select onchange="alterarVendido(${index}, this.value)">
          <option value="FALSE" ${!lote.Vendido || lote.Vendido === "FALSE" ? "selected" : ""}>DisponÃ­vel</option>
          <option value="TRUE" ${lote.Vendido === true || lote.Vendido === "TRUE" ? "selected" : ""}>Vendido</option>
        </select>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

function alterarValor(index, novoValor) {
  lotes[index].Valor = Number(novoValor);
}

function alterarVendido(index, valor) {
  lotes[index].Vendido = valor === "TRUE";
  montarTabela();
}

// ðŸ”¹ SALVA NO BACKEND (Render)
async function salvar() {
  try {
    for (const lote of lotes) {
      await fetch(`${API_BASE}/lotes/${lote.ID}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          Valor: lote.Valor,
          Vendido: lote.Vendido
        })
      });
    }

    alert("Lotes atualizados com sucesso!");
  } catch (err) {
    alert("Erro ao salvar dados");
    console.error(err);
  }
}
</script>





