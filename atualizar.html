<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Atualizar Lotes</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  padding: 20px;
  background: #f7f7f7;
}
h2 { margin-bottom: 10px; }
table {
  border-collapse: collapse;
  width: 100%;
  background: #fff;
  font-size: 19px;
}
th, td {
  border: 1px solid #ddd;
  padding: 6px;
  text-align: center;
}
th { background: #f0f0f0; }
tr.vendido { background-color: #ffd6d6; }
tr.livre { background-color: #d6ffd6; }
input[type="number"] {
  width: 110px;
  padding: 4px;
}
select { padding: 4px; }
button {
  margin-top: 15px;
  padding: 10px 20px;
  font-size: 14px;
  cursor: pointer;
}
</style>
</head>

<body>

<h2>Atualiza√ß√£o de Lotes</h2>

<table id="tabela">
  <thead>
    <tr>
      <th>ID</th>
      <th>Nome</th>
      <th>√Årea</th>
      <th>Valor</th>
      <th>Vendido</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<button onclick="salvar()">üíæ Salvar no Servidor</button>

<script>
const API_BASE = "https://backend-parque-riogrande.onrender.com";

let lotes = [];

// üîπ CARREGAR LOTES DO RENDER
async function carregarLotes() {
  try {
    const res = await fetch(`${API_BASE}/lotes`);
    if (!res.ok) throw new Error();

    const data = await res.json();

    // normaliza
    lotes = data.map(l => ({
      ...l,
      Valor: Number(l.Valor),
      Vendido: l.Vendido === true || l.Vendido === "TRUE"
    }));

    montarTabela();
  } catch {
    alert("‚ùå Erro ao carregar dados do servidor");
  }
}

// üîπ MONTA TABELA
function montarTabela() {
  const tbody = document.querySelector("#tabela tbody");
  tbody.innerHTML = "";

  lotes.forEach((lote, index) => {
    const tr = document.createElement("tr");
    tr.className = lote.Vendido ? "vendido" : "livre";

    tr.innerHTML = `
      <td>${lote.ID}</td>
      <td>${lote.Nome}</td>
      <td>${lote.Area}</td>

      <td>
        <input
          type="number"
          value="${lote.Valor}"
          onchange="alterarValor(${index}, this.value)"
        >
      </td>

      <td>
        <select onchange="alterarVendido(${index}, this.value)">
          <option value="false" ${!lote.Vendido ? "selected" : ""}>Dispon√≠vel</option>
          <option value="true" ${lote.Vendido ? "selected" : ""}>Vendido</option>
        </select>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

// üîπ ALTERA VALOR
function alterarValor(index, novoValor) {
  lotes[index].Valor = Number(novoValor);
}

// üîπ ALTERA STATUS
function alterarVendido(index, valor) {
  lotes[index].Vendido = valor === "true";
  montarTabela();
}

// üîπ SALVA NO BACKEND (Render)
async function salvar() {
  try {
    for (const lote of lotes) {
      const response = await fetch(`${API_BASE}/lotes/${lote.ID}`, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify(lote)
      });

      if (!response.ok) {
        throw new Error("Erro ao salvar lote " + lote.ID);
      }
    }

    alert("‚úÖ Dados salvos com sucesso!");

  } catch (err) {
    console.error(err);
    alert("‚ùå Erro ao salvar os dados");
  }
}

// üîπ INICIALIZA
document.addEventListener("DOMContentLoaded", carregarLotes);
</script>

</body>
</html>













