---
name: Atualizar Status do Lote
on:
  workflow_dispatch:
    inputs:
      lote_id:
        description: "ID do lote a ser atualizado (ex: _1_A_01)"
        required: true
        type: string
      novo_status:
        description: Novo status de vendido
        required: true
        type: choice
        options:
          - "TRUE"
          - "FALSE"
        default: "TRUE"
jobs:
  atualizar-arquivo-json:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout do repositório
        uses: actions/checkout@v4
      - name: Configurar Node.js
        uses: actions/setup-node@v4
        with: node-version: '20'
      - name: Executar script de atualização
        run: >
          node atualizar_lote_ci.js "${{ github.event.inputs.lote_id }}" "${{
          github.event.inputs.novo_status }}"
      - name: Fazer commit das alterações
        run: >
          git config --global user.name 'GitHub Actions Bot'

          git config --global user.email 'github-actions[bot]@users.noreply.github.com'

          git add Lotes.json

          git diff --staged --quiet || git commit -m "CI: Atualiza status do lote ${{ github.event.inputs.lote_id }} para ${{ github.event.inputs.novo_status }}"

          git push
